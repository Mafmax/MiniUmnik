!function r(a,o,l){function d(t,e){if(!o[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var s=o[t]={exports:{}};a[t][0].call(s.exports,function(e){return d(a[t][1][e]||e)},s,s.exports,r,a,o,l)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,n){"use strict";var i={};t.exports={create:function(e,t,n){return this.destroy(i[e]),i[e]=new t(n)},destroy:function(e){e&&(e.clean&&e.clean(),e.undelegateEvents(),e.unbind(),e.remove())}}},{}],2:[function(e,t,n){"use strict";var i=e("./eventModel");t.exports=Backbone.Collection.extend({url:"/ajax/getUnreadNotifications",model:i,state:new Backbone.Model({cnt:0}),initialize:function(){this.limit=5,this.on("add",this.cropTail.bind(this)),this.listenTo(window.vent,"socketEvents",function(e){if("event"===e.type){var t=new Date,n=t.getHours(),i=(t.getMinutes()<10?"0":"")+t.getMinutes();this.add({date:n+":"+i,text:e.eventText.replace("{title}",e.orderTitle).replace("{date}",e.orderDate),order_id:e.orderId,order_title:e.orderTitle}),this.updateCount(e.newCountEvents)}["hasReadEvent","hasReadEventById"].includes(e.type)&&this.fetch({data:{cnt:5}})}.bind(this)),this.fetch({data:{cnt:5}})},parse:function(e){return this.state.set({cnt:e.cnt}),e.items.reverse()},clearEvents:function(){var e=this;$.ajax({type:"post",url:"/ajax/cleanAllUnreadNotification",success:function(){e.reset(),e.state.set({cnt:0}),window.vent.trigger("clearEvents")}})},cropTail:function(){if(this.length>this.limit){var e=this.first();e.trigger("destroy",e)}},updateCount:function(e){this.state.set({cnt:e})}})},{"./eventModel":3}],3:[function(e,t,n){"use strict";t.exports=Backbone.Model.extend({defaults:{author_id:null,customer_nick:null,date:null,group_id:null,id:null,nick_name:null,order_id:null,order_title:null,text:null,tone:null,link:null}})},{}],4:[function(e,t,n){"use strict";var i=Twig.twig({data:e("./templates/eventTemplate.twig")}),s=e("./../_shared/vm");t.exports=Backbone.View.extend({className:"m-eventsPreview__listItem",initialize:function(){this.listenTo(this.model,"remove destroy",function(){s.destroy(this)}.bind(this))},render:function(){return this.$el.html(i.render(this.model.toJSON())),this.el}})},{"./../_shared/vm":1,"./templates/eventTemplate.twig":7}],5:[function(e,t,n){"use strict";var i=Twig.twig({data:e("./templates/eventsPreviewTemplate.twig")}),s=e("./../_shared/vm"),r=e("./eventView");t.exports=Backbone.View.extend({events:{"click [data-js=clearEventList]":"clearEventList"},initialize:function(){this.subViews=[],this.render(),this.listenTo(this.collection,"add",this.addEvent.bind(this)),this.listenTo(this.collection,"reset",this.removeEvents.bind(this)),this.listenTo(this.collection.state,"change:cnt",this.updateCount.bind(this))},render:function(){this.$el.html(i.render())},addEvent:function(e){var t=new r({model:e});this.subViews.push(t),this.$el.find("[data-js=eventsList]").prepend(t.render())},removeEvents:function(){_.each(this.subViews,function(e){s.destroy(e)}.bind(this)),this.subViews=[]},clearEventList:function(){this.collection.clearEvents()},updateCount:function(e,t){this.$el.find("[data-js=eventsCount]").html(t||"")}})},{"./../_shared/vm":1,"./eventView":4,"./templates/eventsPreviewTemplate.twig":8}],6:[function(e,t,n){"use strict";var i=e("./eventsPreviewView"),s=e("./eventCollection");$(function(){window.vent=window.vent||_.extend({},Backbone.Events),new i({el:$("[data-js=eventsPreview]"),collection:new s})})},{"./eventCollection":2,"./eventsPreviewView":5}],7:[function(e,t,n){t.exports='<a class="m-eventsPreview__link" href="{{ link }}">\n    <div class="m-eventsPreview__text">{{ text }}</div>\n    <div class="m-eventsPreview__name">{{ order_title }}</div>\n    <div class="m-eventsPreview__date">{{ date }}</div>\n</a>\n'},{}],8:[function(e,t,n){t.exports='<a href="/home?scroll=notice" class="m-eventsPreview__menuItem">\n    <div class="m-eventsPreview__count" data-js="eventsCount"></div>\n</a>\n<div class="m-eventsPreview__events">\n    <div class="m-eventsPreview__list" data-js-listHeading="Новые уведомления" data-js="eventsList"></div>\n    <div class="m-eventsPreview__isEmpty">У вас нет новых уведомлений</div>\n    <div class="m-eventsPreview__clear" data-js="clearEventList">Очистить уведомления</div>\n</div>\n'},{}]},{},[6]);